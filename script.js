const gridEl=document.querySelector('#products');const searchEl=document.querySelector('#search');const productEl=document.querySelector('#product');
async function loadProducts(){const r=await fetch('products.json');const d=await r.json();return d.items;}
function renderGrid(items){if(!gridEl)return;gridEl.innerHTML='';items.forEach(p=>{const a=document.createElement('a');a.href=`product.html?slug=${encodeURIComponent(p.slug)}`;a.className='card';a.innerHTML=`<img src="${p.image}" alt="${p.name}"><div class="body"><div class="badges">${(p.badges||[]).map(b=>'<span class="badge">'+b+'</span>').join('')}</div><div class="title">${p.name}</div><div class="price">$ ${p.price}</div></div>`;gridEl.appendChild(a);});}
function getQueryParam(n){const u=new URL(location.href);return u.searchParams.get(n);}
function renderProduct(p){if(!productEl)return;productEl.innerHTML=`<div class="gallery"><img src="${p.image}" alt="${p.name}"></div><div class="panel"><div class="badges">${(p.badges||[]).map(b=>'<span class="badge">'+b+'</span>').join('')}</div><h1>${p.name}</h1><div class="kv"><span>Tooth Powder</span><span>50g</span><span>Gentle polish</span></div><div class="price" style="font-size:22px">$ ${p.price}</div><p style="color:#374151;margin-top:10px">${p.description||''}</p><hr/><div class="paylinks"><a class="button" href="${p.stripe_payment_link}" target="_blank" rel="noopener">Buy with Stripe</a><a class="button secondary" href="index.html">Back to products</a></div><div class="note">Checkout opens Stripeâ€™s hosted page. No backend required.</div></div>`;}
(async()=>{const items=await loadProducts();const slug=getQueryParam('slug');if(slug){const p=items.find(i=>i.slug===slug)||items[0];renderProduct(p);}else{renderGrid(items);if(searchEl){searchEl.addEventListener('input',e=>{const q=e.target.value.toLowerCase();const filtered=items.filter(p=>(p.name+p.description).toLowerCase().includes(q));renderGrid(filtered);});}}})();